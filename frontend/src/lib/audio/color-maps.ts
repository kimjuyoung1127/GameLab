/** Magma 컬러맵: dB 값을 RGBA 색상으로 변환하는 256-entry LUT. */

// Magma colormap (256 entries): dark → purple → orange → yellow
// Sampled from matplotlib's magma colormap
const MAGMA_LUT: [number, number, number][] = [
  [0,0,4],[1,0,5],[1,1,6],[1,1,8],[2,1,10],[2,2,12],[2,2,14],[3,2,16],
  [4,3,18],[4,3,20],[5,4,23],[6,4,25],[7,5,27],[8,5,29],[9,6,31],[10,7,34],
  [11,7,36],[12,8,38],[13,8,41],[14,9,43],[16,9,45],[17,10,48],[18,10,50],
  [20,11,52],[21,11,55],[22,11,57],[24,12,60],[25,12,62],[27,12,65],[28,12,67],
  [30,12,69],[31,12,72],[33,12,74],[35,12,76],[36,12,79],[38,12,81],[40,11,83],
  [41,11,85],[43,11,87],[45,11,89],[47,11,91],[49,11,93],[51,11,95],[52,10,97],
  [54,10,99],[56,10,100],[58,10,102],[60,10,104],[62,10,105],[64,10,107],
  [66,9,108],[68,9,110],[70,9,111],[72,9,112],[74,9,113],[76,9,115],[78,10,116],
  [80,10,117],[82,10,118],[84,10,119],[86,11,120],[88,11,120],[90,11,121],
  [92,12,122],[94,12,122],[96,13,123],[98,13,123],[100,14,124],[102,14,124],
  [104,15,125],[106,15,125],[108,16,125],[110,16,126],[112,17,126],[114,18,126],
  [116,18,126],[118,19,127],[120,19,127],[122,20,127],[124,21,127],[126,21,127],
  [128,22,127],[130,22,127],[132,23,127],[134,24,127],[136,24,127],[138,25,127],
  [140,25,127],[142,26,127],[144,27,127],[146,27,126],[148,28,126],[150,28,126],
  [152,29,126],[154,30,125],[155,30,125],[157,31,125],[159,31,124],[161,32,124],
  [163,33,123],[165,33,123],[167,34,122],[168,34,122],[170,35,121],[172,36,121],
  [174,36,120],[176,37,119],[178,37,119],[179,38,118],[181,39,117],[183,39,117],
  [185,40,116],[187,41,115],[188,41,114],[190,42,114],[192,43,113],[194,43,112],
  [195,44,111],[197,45,110],[199,45,109],[201,46,108],[202,47,108],[204,48,107],
  [206,49,106],[207,49,105],[209,50,104],[211,51,103],[212,52,102],[214,53,101],
  [216,54,100],[217,55,99],[219,56,98],[220,57,97],[222,58,96],[223,59,95],
  [225,60,94],[226,61,93],[228,62,92],[229,63,91],[231,64,90],[232,66,89],
  [233,67,88],[235,68,87],[236,69,86],[237,71,85],[239,72,84],[240,73,83],
  [241,75,82],[242,76,81],[244,78,80],[245,79,79],[246,81,78],[247,82,77],
  [248,84,76],[249,86,76],[250,87,75],[251,89,74],[252,91,73],[252,93,73],
  [253,94,72],[254,96,71],[254,98,71],[255,100,70],[255,102,70],[255,104,69],
  [255,106,69],[255,108,69],[255,110,68],[255,112,68],[255,114,68],[255,116,68],
  [255,118,68],[255,120,68],[255,122,68],[255,124,68],[255,126,68],[255,128,69],
  [255,130,69],[255,132,69],[255,134,70],[255,136,70],[255,138,71],[255,140,71],
  [255,142,72],[255,144,73],[255,146,73],[255,148,74],[255,150,75],[255,152,76],
  [255,154,77],[255,155,78],[255,157,79],[255,159,80],[255,161,81],[255,163,82],
  [255,165,84],[255,167,85],[255,169,86],[255,171,88],[255,172,89],[255,174,91],
  [255,176,92],[255,178,94],[255,180,96],[255,182,97],[255,183,99],[255,185,101],
  [255,187,103],[255,189,105],[255,191,107],[255,192,109],[255,194,111],
  [255,196,113],[255,198,115],[255,200,117],[255,201,119],[255,203,121],
  [255,205,124],[255,207,126],[255,208,128],[255,210,131],[255,212,133],
  [255,213,135],[255,215,138],[255,217,140],[255,218,143],[255,220,145],
  [255,222,148],[255,223,151],[255,225,153],[255,227,156],[255,228,159],
  [255,230,161],[255,231,164],[255,233,167],[255,234,170],[255,236,173],
  [255,237,176],[255,239,179],[255,240,182],[255,242,185],[255,243,188],
  [255,245,191],[255,246,194],[255,247,198],[255,249,201],[255,250,204],
  [255,251,208],[255,252,211],[255,253,215],[255,254,218],[255,255,222],
  [255,255,225],[255,255,229],[255,255,233],[255,255,236],[255,255,240],
  [252,254,243],[252,254,246],[252,254,249],[252,254,252],
];

export type ColorMapName = "magma";

/**
 * dB 값을 RGBA 색상으로 변환.
 * @param db - 현재 dB 값
 * @param minDb - 최소 dB (이하는 투명/검정)
 * @param maxDb - 최대 dB
 * @returns [r, g, b, a] 각 0-255
 */
export function dbToColor(
  db: number,
  minDb: number,
  maxDb: number,
): [number, number, number, number] {
  if (db <= minDb) return [0, 0, 0, 255];
  if (db >= maxDb) {
    const c = MAGMA_LUT[255];
    return [c[0], c[1], c[2], 255];
  }
  const t = (db - minDb) / (maxDb - minDb);
  const idx = Math.round(t * 255);
  const c = MAGMA_LUT[idx];
  return [c[0], c[1], c[2], 255];
}
